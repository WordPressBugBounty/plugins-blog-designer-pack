var timer,bdpp_shrt_notice_timeout,timeOut_Val=300,timeOut=timeOut_Val,tmpl_id=jQuery(".bdpp-customizer").attr("data-template"),preview_shortcode=jQuery(".bdpp-customizer").attr("data-shortcode"),bdpp_shrt_nonce=jQuery(".bdpp-customizer").attr("data-nonce"),checked_show_dep=[],dep_wrap=".bdpp-shrt-fields-panel",dependency=!!(dependency=jQuery(dep_wrap+" .bdpp-cust-dependency").attr("data-dependency"))&&JSON.parse(dependency),bdpp_shrt_ajax_fields=jQuery(dep_wrap+" .bdpp-cust-dependency").attr("data-ajax-fields");function bdpp_get_shortcode_params(e){var p=jQuery(e).val(),t=(p=p.trim()).substr(0,1),r=p.substr(-1);return""!=p&&("["==t&&"]"==r&&(t=(p=(p=p.slice(1,-1)).trim()).substr(0,1),r=p.substr(-1)),"["!=t&&(p="["+p),"]"!=r&&(p+="]"),jQuery(e).val(p),temp_shrt_val=p.slice(1,-1),temp_shrt_val=temp_shrt_val.trim(),wp.shortcode.attrs(temp_shrt_val))}function bdpp_set_shortcode_params(d,e,p){var r=!1,a=".bdpp-shrt-fields-panel";return"click"==p&&void 0!==e&&""!=e&&jQuery.each(e.named,function(t,e){var p,r;void 0!==t&&""!=t&&(t in d.named&&""!=d.named[t]||(p=jQuery(a+" .bdpp-"+t).closest(".bdpp-customizer-row").attr("data-type"),r=(r=jQuery(a+" .bdpp-"+t).attr("data-default"))||"","dropdown"==p&&0<jQuery(a+" .bdpp-"+t+" option[value='"+r+"']").length?jQuery(a+" .bdpp-"+t).val(r).trigger("bdpp-cust-dependency-change"):"multi-dropdown"==p?(jQuery(a+" .bdpp-"+t).hasClass("bdpp-ajax-select2")?jQuery(a+" .bdpp-"+t).val(""):jQuery.each(r.split(","),function(e,p){jQuery(a+" .bdpp-"+t+" option[value='"+p+"']").prop("selected",!0)}),jQuery(a+" .bdpp-"+t).trigger("bdpp-cust-dependency-change")):"colorpicker"==p?jQuery(a+" .bdpp-"+t).val(r).trigger("change"):"text"!=p&&"number"!=p||jQuery(a+" .bdpp-"+t).val(r).trigger("bdpp-cust-dependency-change")))}),jQuery.each(d.named,function(t,e){var p;t&&("dropdown"==(p=jQuery(a+" .bdpp-"+t).closest(".bdpp-customizer-row").attr("data-type"))&&0<jQuery(a+" .bdpp-"+t+" option[value='"+e+"']").length?jQuery(a+" .bdpp-"+t).val(e).trigger("bdpp-cust-dependency-change"):"multi-dropdown"==p?(jQuery.each(e.split(","),function(e,p){jQuery(a+" .bdpp-"+t+" option[value='"+p+"']").prop("selected",!0)}),jQuery(a+" .bdpp-"+t).trigger("bdpp-cust-dependency-change")):"colorpicker"==p?jQuery(a+" .bdpp-"+t).val(e).trigger("change"):"text"!=p&&"number"!=p||jQuery(a+" .bdpp-"+t).val(e).trigger("bdpp-cust-dependency-change"),r=!0)}),r}function bdpp_generate_shortcode_preview(p){var o="",t=jQuery(".bdpp-customizer"),n=jQuery(".bdpp-shrt-fields-panel"),p=p||!1;clearTimeout(timer),timer=setTimeout(function(){console.log("preview initialized"),jQuery(".bdpp-shrt-preview-window .bdpp-shrt-loader").fadeIn(),o+="["+preview_shortcode,n.find('input[type="text"], input[type="checkbox"]:checked, input[type="radio"], input[type="number"], textarea, select').each(function(e,p){var t,r,d,a;jQuery(this).hasClass("bdpp-cust-hidden-field")||(t=(t=jQuery(this).val())||"",r=jQuery(this).attr("name"),d=jQuery(this).attr("data-default"),a=jQuery(this).attr("data-empty"),void 0===t||""==t&&!a||t==d||(o+=" "+r+'="'+t+'"'))}),o+="]",t.find(".bdpp-shrt-box").val(o),t.find(".bdpp-customizer-old-shrt").val(o);var r,d,s,e,a=!1;p&&(jQuery(".bdpp-shrt-invalid-param-notice").hide(),jQuery(".bdpp-shrt-acc-header-warn-icon").hide(),jQuery(".bdpp-customizer-row").removeClass("bdpp-customizer-row-error"),r={},d=bdpp_get_shortcode_params(".bdpp-shrt-box"),"force"==p&&(a=!0),bdpp_shrt_ajax_fields&&jQuery.each(bdpp_shrt_ajax_fields,function(e,p){var t;p in d.named&&(a=!0,(t=jQuery(".bdpp-"+p).attr("data-predefined"))&&(r[p]=JSON.parse(t)))})),a?(s=jQuery(".bdpp-shrt-accordion"),jQuery(".bdpp-shrt-fields-panel .bdpp-shrt-loader").fadeIn(),e={action:"bdpp_get_shrt_params_data",shortcode:preview_shortcode,params:d.named,predefined_params:r,nonce:bdpp_shrt_nonce},jQuery.post(ajaxurl,e,function(r){var a;jQuery.isEmptyObject(r.invalid_params)||(a="",jQuery.each(r.invalid_params,function(e,p){jQuery(".bdpp-shrt-invalid-param-notice").show();var t=s.find(".bdpp-"+e).closest(".bdpp-shrt-acc-cnt").attr("aria-labelledby"),r=s.find(".bdpp-"+e).closest(".bdpp-customizer-row"),d=r.find(".bdpp-shrt-lbl").text();jQuery("#"+t+" .bdpp-shrt-acc-header-warn-icon").show(),r.addClass("bdpp-customizer-row-error"),a+=d+" ("+e+'="'+p+'"), '}),a=a.replace(/,\s*$/,""),jQuery(".bdpp-shrt-invalid-param-notice .bdpp-shrt-invalid-params").text(a)),jQuery.each(r.data,function(e,p){var t=s.find(".bdpp-"+e).closest(".bdpp-customizer-row").data("type");"multi-dropdown"==t||"dropdown"==t?s.find(".bdpp-"+e).html(r.data[e]):s.find(".bdpp-"+e).val(r.data[e])}),jQuery(".bdpp-shrt-fields-panel .bdpp-shrt-loader").fadeOut(),jQuery("#bdpp-customizer-shrt-form").trigger("submit")})):jQuery("#bdpp-customizer-shrt-form").trigger("submit")},timeOut)}function bdpp_check_ref_dependency(t){var r;t in dependency&&(r=jQuery(dep_wrap+" .bdpp-"+t).val(),jQuery.each(dependency[t].show,function(e,p){jQuery(dep_wrap+" .bdpp-"+e).closest(".bdpp-customizer-row").hide(),jQuery(dep_wrap+" .bdpp-"+e).addClass("bdpp-cust-hidden-field"),-1===jQuery.inArray(r,p)||jQuery(dep_wrap+" .bdpp-"+t).hasClass("bdpp-cust-hidden-field")||(jQuery(dep_wrap+" .bdpp-"+e).closest(".bdpp-customizer-row").show(),jQuery(dep_wrap+" .bdpp-"+e).removeClass("bdpp-cust-hidden-field")),bdpp_check_ref_dependency(e)}),checked_show_dep.push(t))}function bdpp_check_hide_ref_dependency(t){var r;t in dependency&&(r=jQuery(dep_wrap+" .bdpp-"+t).val(),jQuery.each(dependency[t].hide,function(e,p){jQuery(dep_wrap+" .bdpp-"+e).closest(".bdpp-customizer-row").hide(),jQuery(dep_wrap+" .bdpp-"+e).addClass("bdpp-cust-hidden-field"),-1!=jQuery.inArray(r,p)||jQuery(dep_wrap+" .bdpp-"+t).hasClass("bdpp-cust-hidden-field")||(jQuery(dep_wrap+" .bdpp-"+e).closest(".bdpp-customizer-row").show(),jQuery(dep_wrap+" .bdpp-"+e).removeClass("bdpp-cust-hidden-field")),bdpp_check_hide_ref_dependency(e)}))}function bdpp_shrt_display_notice(e,p="success"){e&&(jQuery(".bdpp-shrt-notice").remove(),jQuery("body").append('<div class="bdpp-shrt-notice bdpp-shrt-notice-'+p+'">'+e+"</div>"),jQuery(".bdpp-shrt-notice").fadeIn(),clearTimeout(bdpp_shrt_notice_timeout),bdpp_shrt_notice_timeout=setTimeout(function(){jQuery(".bdpp-shrt-notice").fadeOut()},5e3))}bdpp_shrt_ajax_fields=!!bdpp_shrt_ajax_fields&&JSON.parse(bdpp_shrt_ajax_fields),function(i){"use strict";i(document).on("click",".bdpp-shrt-dwp",function(){i("body").toggleClass("bdpp-shrt-full-preview"),i(this).toggleClass("bdpp-shrt-dwp-active")}),i("#bdpp-shrt-accordion").accordion({collapsible:!0,active:!1,heightStyle:"content",icons:{header:"dashicons dashicons-arrow-down-alt2",activeHeader:"dashicons dashicons-arrow-up-alt2"}}),0<i(".bdpp-cust-color-box").length&&i(".bdpp-cust-color-box").wpColorPicker({change:function(e,p){bdpp_generate_shortcode_preview(!0)},clear:function(){bdpp_generate_shortcode_preview(!0)}}),i(document).on("change",'.bdpp-shrt-fields-panel select, .bdpp-shrt-fields-panel input[type="number"]',function(){var e=i(this),p=!0,t=(e.closest(".bdpp-shrt-accordion"),e.attr("data-timeout"));timeOut=void 0!==t?t:timeOut_Val,e.hasClass("bdpp-post-type-sel")&&(p="force"),bdpp_generate_shortcode_preview(p)}),i(document).on("keyup",'.bdpp-shrt-fields-panel input[type="text"], .bdpp-shrt-fields-panel input[type="number"]',function(){var e=i(this).attr("data-timeout");timeOut=void 0!==e?e:timeOut_Val,bdpp_generate_shortcode_preview(!0)}),i(document).on("change",".bdpp-shrt-switcher",function(){0<i(".bdpp-layout-wrap").length&&(e={title:i(".bdpp-layout-wrap .bdpp-layout-title").val()||"",description:i(".bdpp-layout-wrap .bdpp-layout-desc").val()||"",enable:i(".bdpp-layout-enable").is(":checked")?1:0},e=JSON.stringify(e),bdpp_create_cookie("bdpp_layout_temp_data",e,!1,!1,"Strict"));var e=i(this).find(":selected").attr("data-url");void 0!==e&&""!=e&&(window.location=e)}),jQuery("#bdpp-customizer-shrt-form").on("submit",function(e){var p=i(this).attr("target");if(void 0===p||""==p)return!1}),i(document).on("click",".bdpp-cust-shrt-generate",function(e,p){var r,s,t,d=!1,a=!0,o=bdpp_get_shortcode_params(".bdpp-shrt-box"),n=bdpp_get_shortcode_params(".bdpp-customizer-old-shrt"),p=void 0!==p&&""!=p?p:"click";if(o&&o.numeric[0]&&o.numeric[0]!==preview_shortcode)return alert(Bdpp_Shrt_Generator.shortcode_err),!1;i(".bdpp-shrt-invalid-param-notice").hide(),i(".bdpp-shrt-acc-header-warn-icon").hide(),i(".bdpp-customizer-row").removeClass("bdpp-customizer-row-error"),o.named&&(r={},bdpp_shrt_ajax_fields&&i.each(bdpp_shrt_ajax_fields,function(e,p){var t;p in o.named&&(a=!0,(t=i(".bdpp-"+p).attr("data-predefined"))&&(r[p]=JSON.parse(t)))}),a?(s=i(".bdpp-shrt-accordion"),i(".bdpp-shrt-fields-panel .bdpp-shrt-loader").fadeIn(),t={action:"bdpp_get_shrt_params_data",shortcode:preview_shortcode,params:o.named,predefined_params:r,nonce:bdpp_shrt_nonce},i.post(ajaxurl,t,function(r){var a;i.isEmptyObject(r.invalid_params)||(a="",i.each(r.invalid_params,function(e,p){i(".bdpp-shrt-invalid-param-notice").show();var t=s.find(".bdpp-"+e).closest(".bdpp-shrt-acc-cnt").attr("aria-labelledby"),r=s.find(".bdpp-"+e).closest(".bdpp-customizer-row"),d=r.find(".bdpp-shrt-lbl").text();i("#"+t+" .bdpp-shrt-acc-header-warn-icon").show(),r.addClass("bdpp-customizer-row-error"),a+=d+" ("+e+'="'+p+'"), '}),a=a.replace(/,\s*$/,""),i(".bdpp-shrt-invalid-param-notice .bdpp-shrt-invalid-params").text(a)),i.each(r.data,function(e,p){var t=s.find(".bdpp-"+e).closest(".bdpp-customizer-row").data("type");"multi-dropdown"==t||"dropdown"==t?s.find(".bdpp-"+e).html(r.data[e]):s.find(".bdpp-"+e).val(r.data[e])}),bdpp_set_shortcode_params(o,n,p),i(".bdpp-shrt-fields-panel .bdpp-shrt-loader").fadeOut(),bdpp_generate_shortcode_preview()})):(d=bdpp_set_shortcode_params(o,n,p),bdpp_generate_shortcode_preview())),1!=d&&1!=a&&bdpp_generate_shortcode_preview()}),""!=tmpl_id?setTimeout(function(){i(".bdpp-cust-shrt-generate").trigger("click",["trigger"])},10):bdpp_generate_shortcode_preview(),dependency&&i.each(dependency,function(e,p){e&&(setTimeout(function(){-1==i.inArray(e,checked_show_dep)&&i(dep_wrap+" .bdpp-"+e).trigger("bdpp-cust-dependency-change")},10),i(document).on("change keyup bdpp-cust-dependency-change",dep_wrap+" .bdpp-"+e,function(){var t=i(this).val();p.show&&i.each(p.show,function(e,p){i(dep_wrap+" .bdpp-"+e).closest(".bdpp-customizer-row").hide(),i(dep_wrap+" .bdpp-"+e).addClass("bdpp-cust-hidden-field"),-1!==i.inArray(t,p)&&(i(dep_wrap+" .bdpp-"+e).closest(".bdpp-customizer-row").show(),i(dep_wrap+" .bdpp-"+e).removeClass("bdpp-cust-hidden-field")),bdpp_check_ref_dependency(e)}),p.hide&&i.each(p.hide,function(e,p){i(dep_wrap+" .bdpp-"+e).closest(".bdpp-customizer-row").show(),i(dep_wrap+" .bdpp-"+e).removeClass("bdpp-cust-hidden-field"),-1!==i.inArray(t,p)&&(i(dep_wrap+" .bdpp-"+e).closest(".bdpp-customizer-row").hide(),i(dep_wrap+" .bdpp-"+e).addClass("bdpp-cust-hidden-field")),bdpp_check_hide_ref_dependency(e)})}))}),i(document).on("submit",".bdpp-layout-submit-form",function(){var e=bdpp_get_shortcode_params(".bdpp-shrt-box");if(e&&e.numeric[0]&&e.numeric[0]!==preview_shortcode)return alert(Bdpp_Shrt_Generator.shortcode_err),!1;e=i(".bdpp-shrt-box").val();i(".bdpp-layout-wrap .bdpp-layout-shrt-val").val(e)}),i(document).on("click",".bdpp-layout-debug-js",function(){return i(".bdpp-layout-wrap .bdpp-shrt-box-wrp").toggleClass("bdpp-hide"),!1}),0<i(".bdpp-layout-wrap").length&&bdpp_delete_cookie("bdpp_layout_temp_data","Strict"),i(".bdpp-select2").each(function(e){i(this).select2({theme:"default bdpp-select2-inp",width:"100%"})}),i(".bdpp-ajax-select2").each(function(e){var p=i(this),r=i(this).attr("data-predefined"),t=i(this).data("ajax-action"),d=(d=i(this).data("search-msg"))||Bdpp_Shrt_Generator.select2_input_too_short,a=(a=i(this).data("placeholder"))||Bdpp_Shrt_Generator.select2_placeholder;void 0!==t&&""!=t&&p.select2({ajax:{url:ajaxurl,dataType:"json",delay:500,data:function(e){e=e.term.trim();return{action:t,search:e,nonce:bdpp_shrt_nonce,post_type:i(".bdpp-post-type-sel").val(),taxonomy:i(".bdpp-taxonomy-sel").val(),all_parents_opt:p.hasClass("bdpp-filter_cat_parent")?1:0}},processResults:function(e){var t=[];return r&&(t=JSON.parse(r),t=i.makeArray(t)),e&&i.each(e,function(e,p){t.push({id:p[0],text:p[1]})}),{results:t}},cache:!0},width:"100%",theme:"default bdpp-select2-inp",minimumInputLength:1,allowClear:!0,closeOnSelect:!0,placeholder:a,language:{inputTooShort:function(){return d},removeAllItems:function(){return Bdpp_Shrt_Generator.select2_remove_all_items},removeItem:function(){return Bdpp_Shrt_Generator.select2_remove_item},searching:function(){return Bdpp_Shrt_Generator.select2_searching}}}).on("select2:unselect",function(e){setTimeout(function(){p.select2("close")},10)})}),jQuery(".bdpp-customizer .bdpp-shrt-preview-frame").on("load",function(){jQuery(".bdpp-shrt-preview-window .bdpp-shrt-loader").fadeOut()})}(jQuery);